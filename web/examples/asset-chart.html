<!DOCTYPE html>
<html lang="en">
<head>
    <title>dc.js - Asset Chart Example</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="../css/dc.css"/>
</head>
<body>

<div id="asset-test"></div>

<script type="text/javascript" src="../js/d3.js"></script>
<script type="text/javascript" src="../js/crossfilter.js"></script>
<script type="text/javascript" src="../js/dc.js"></script>
<script type="text/javascript">

function loadAssetChartFixture() {
    var data = JSON.parse("[" +
        "{\"date\":\"2014-01-02\",\"open\":557.17,\"high\":558.32,\"low\":553.58,\"close\":556.00}, " +
        "{\"date\":\"2014-01-03\",\"open\":556.94,\"high\":557.91,\"low\":551.91,\"close\":551.95}, " +
        "{\"date\":\"2014-01-06\",\"open\":555.95,\"high\":558.87,\"low\":552.67,\"close\":558.10}, " +
        "{\"date\":\"2014-01-07\",\"open\":561.94,\"high\":569.28,\"low\":560.02,\"close\":568.86}, " +
        "{\"date\":\"2014-01-08\",\"open\":572.43,\"high\":573.09,\"low\":566.08,\"close\":570.04}, " +
        "{\"date\":\"2014-01-09\",\"open\":571.15,\"high\":571.54,\"low\":562.22,\"close\":564.55}, " +
        "{\"date\":\"2014-01-10\",\"open\":568.97,\"high\":568.97,\"low\":560.56,\"close\":564.52}, " +
        "{\"date\":\"2014-01-13\",\"open\":562.67,\"high\":572.88,\"low\":558.03,\"close\":560.93}, " +
        "{\"date\":\"2014-01-14\",\"open\":568.41,\"high\":574.92,\"low\":563.48,\"close\":574.13}, " +
        "{\"date\":\"2014-01-15\",\"open\":575.92,\"high\":576.92,\"low\":571.32,\"close\":573.74}, " +
        "{\"date\":\"2014-01-16\",\"open\":573.98,\"high\":578.39,\"low\":573.43,\"close\":577.53}, " +
        "{\"date\":\"2014-01-17\",\"open\":577.85,\"high\":579.73,\"low\":571.53,\"close\":574.69}, " +
        "{\"date\":\"2014-01-21\",\"open\":579.88,\"high\":581.42,\"low\":575.07,\"close\":581.27}, " +
        "{\"date\":\"2014-01-22\",\"open\":582.72,\"high\":583.36,\"low\":578.85,\"close\":581.93}, " +
        "{\"date\":\"2014-01-23\",\"open\":579.42,\"high\":580.66,\"low\":576.61,\"close\":579.47}, " +
        "{\"date\":\"2014-01-24\",\"open\":574.93,\"high\":576.20,\"low\":560.94,\"close\":561.35}, " +
        "{\"date\":\"2014-01-27\",\"open\":562.49,\"high\":562.69,\"low\":540.59,\"close\":550.06}, " +
        "{\"date\":\"2014-01-28\",\"open\":554.60,\"high\":562.31,\"low\":554.42,\"close\":560.94}, " +
        "{\"date\":\"2014-01-29\",\"open\":559.00,\"high\":560.31,\"low\":549.16,\"close\":552.91}, " +
        "{\"date\":\"2014-01-30\",\"open\":571.93,\"high\":575.67,\"low\":563.06,\"close\":567.13}, " +
        "{\"date\":\"2014-01-31\",\"open\":585.09,\"high\":592.68,\"low\":574.99,\"close\":589.89} " +
        "]");
    for (var ii = 0; ii < data.length; ii++) {
        data[ii].date = new Date(data[ii].date);
    }
    return data;
}

var chart = dc.assetChart('#asset-test');
var data = crossfilter(loadAssetChartFixture());

var dimension = data.dimension(function (d) { return d.date; });
var group = dimension.group().reduce(
        function (p, v) {
            p.open = p.open || v.open;
            p.high = Math.max(p.high || v.high, v.high);
            p.low = Math.min(p.low || v.low, v.low);
            p.close = v.close;
            return p;
        },
        function (p, v) { return p; },
        function () { return { }; }
    );
chart
    .dimension(dimension)
    .group(group)
    .width(768)
    .height(480)
    .xUnits(d3.time.days)
    .x(d3.time.scale().domain([dimension.bottom(1)[0].date, new Date(dimension.top(1)[0].date).setDate(dimension.top(1)[0].date.getDate() + 1)]))
    .y(d3.scale.linear().domain([540, 600]))
    .margins({top: 10, right: 50, bottom: 30, left: 50});

//chart.xAxis().tickFormat(function (v) { return (v.getMonth() + 1) + '/' + v.getDay() + '/' + v.getFullYear(); });
dc.renderAll();

</script>

</body>
</html>
